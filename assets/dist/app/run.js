define(["jquery","marked","lib/cookie"],function(e,t,n){var r="index",i="#!/",s=i.length,o=i+"tag=",u=o.length,a=navigator.userAgent.indexOf("iPhone")>=0||navigator.userAgent.indexOf("Android")>=0?!0:!1,f=a?4:8,l=function(){var s={},a=0,c={};s.page=location.hash.indexOf(i)>=0&&location.hash.indexOf(o)<0&&location.hash.substr(2)||r,s.tag=location.hash.indexOf(o)>=0&&location.hash.substr(u)||"",e("body").html("Loading..."),require(["text!/data/articles/"+s.page+".md"],function(r){e("body").html(t(r)),e("a[href^='/']").each(function(){if(this.href.indexOf("#")>=0){var t=this.href.substr(location.origin.length+2);this.href=o+t,"index"==s.page&&(e(this).parents("li").addClass("tag_"+t),t&&(c[t]=c[t]||0,c[t]+=1))}else this.href=i+this.href.substr(location.origin.length+1),"index"==s.page&&(a+=1);"index"==s.page&&(n.set("tags",JSON.stringify(c)),n.set("total",a)),e(this).off("click").on("click",function(){location.hash=this.href.split("#")[1],l()})});if("index"==s.page)e("a[href^='"+o+"']").parents("li").addClass("tags"),s.tag.length?(e(".tags").hide(),e(".tag_"+s.tag).show()):e(".tags").show();else{var u;if(u=n.get("tags"))c=JSON.parse(u);a=n.get("total")}e("a[href^='"+o+"']").css({color:"#aaa"}),e("title").html(("index"!=s.page?e("h1").text()+" - ":"")+"Kirin's Blog");var h='<div class="nav menu"><ul><li><a href="#" title="Including '+a+' articles.">HOME</a></li>';for(var p in c)h+='<li><a href="'+o+p+'" title="Including '+c[p]+' articles.">'+p.toUpperCase()+"</a></li>";h+="</ul></div>",e("body").append(h),e(".nav li").slice(f).length&&(e(".nav li").slice(f).hide(),e(".nav ul").append('<li><a href="javascript:;" title="Show tags.">...</a></li>'),e(".nav li").last().on("click",function(){e(".nav li").slice(f).toggle()})),e(".nav").css({position:"fixed",top:"0px",left:"0px",width:"100%","z-index":"998",background:"#eee","font-weight":"bold"}),e(".nav ul").css({"list-style":"none"}),e(".nav li").css({"float":"left",padding:"6px"}),e(".nav").height()>e("body").offset().top&&e("body").css({"margin-top":e(".nav").height()+e("body").offset().top}),e("a").each(function(){this.href.indexOf(location.host)<0&&e(this).attr("target","_blank")}),setTimeout(function(){e.getScript("http://s95.cnzz.com/stat.php?id=1253192811");if(!e(".ds-thread").length){var t=document.createElement("div");t.setAttribute("class","ds-thread"),t.setAttribute("data-thread-key",s.page),t.setAttribute("data-title",document.title),t.setAttribute("data-url",location.href),window.DUOSHUO.EmbedThread(t),e("body").append(t)}},3e3),e("html,body").animate({scrollTop:0})})};location.hash.indexOf("#!")>=0&&location.hash.indexOf(i)<0&&(location.hash=location.hash.replace("#!",i)),location.origin=location.protocol+"//"+location.hostname,"onhashchange"in window&&"addEventListener"in window&&"function"==typeof window.addEventListener&&(window.onhashchange=l),l(),a?(e("head").append('<meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">'),e("body").addClass("markdown-body").css({margin:"16px"})):e("body").addClass("markdown-body").css({margin:"64px"}),window.duoshuoQuery={short_name:"qbless"},e.getScript("http://static.duoshuo.com/embed.js")});